name: System Environment Check
on: 
  workflow_dispatch:  # æ”¯æŒæ‰‹åŠ¨è§¦å‘[5](@ref)

jobs:
  system-check:
    runs-on: ubuntu-latest  # æŽ¨èä½¿ç”¨æœ€æ–°UbuntuçŽ¯å¢ƒ[1,5](@ref)
    steps:
      - name: Check system info
        run: |
          # è¾“å‡ºåŸºç¡€ç³»ç»Ÿä¿¡æ¯
          echo "### ç³»ç»ŸçŽ¯å¢ƒæŠ¥å‘Š âš™ï¸"
          echo "---"
          echo "ç³»ç»Ÿç‰ˆæœ¬: $(lsb_release -d | cut -f2-)"
          echo "å†…æ ¸ç‰ˆæœ¬: $(uname -r)"
          echo "CPUæž¶æž„: $(uname -m)"
          echo "CPUæ ¸å¿ƒæ•°: $(nproc)"
          echo "å†…å­˜æ€»é‡: $(free -m | awk '/Mem/ {print $2}') MB"
          echo "---"

          # è¯¦ç»†ç£ç›˜ç©ºé—´æ£€æŸ¥
          echo "### å­˜å‚¨ç©ºé—´åˆ†æž ðŸ’¾"
          df -h | grep -v tmpfs  # æŽ’é™¤ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ
          echo "---"

          # ä¸“é¡¹æ£€æŸ¥å·¥ä½œç›®å½•
          echo "å·¥ä½œåŒºè·¯å¾„: $GITHUB_WORKSPACE"
          du -sh $GITHUB_WORKSPACE | awk '{print "å·¥ä½œåŒºå ç”¨: "$1}'
          
          # æ£€æŸ¥å¸¸è§ç¼“å­˜ç›®å½•
          echo "Node_modulesç¼“å­˜: $(du -sh /usr/local/lib/node_modules 2>/dev/null || echo 'æœªæ‰¾åˆ°')"
          echo "Dockeré•œåƒå ç”¨: $(docker system df --format '{{.Size}}' 2>/dev/null || echo 'Dockeræœªå®‰è£…')"
          echo "---"

          # çŽ¯å¢ƒå˜é‡è¯Šæ–­
          echo "### è¿è¡ŒçŽ¯å¢ƒå˜é‡ ðŸ› ï¸"
          echo "Runnerç±»åž‹: ${{ runner.os }}"
          echo "Jobå®¹å™¨æ¨¡å¼: ${{ job.container }}"
          echo "GitHub API: ${{ github.api_url }}"

      - name: Generate report
        if: always()  # å³ä½¿æ­¥éª¤å¤±è´¥ä¹Ÿæ‰§è¡Œ
        run: |
          # å°†å…³é”®æŒ‡æ ‡å†™å…¥æ–‡ä»¶
          echo "SYSTEM_REPORT=$(date +%Y-%m-%d_%H-%M-%S).log" >> $GITHUB_ENV
          df -h > $SYSTEM_REPORT
          free -m >> $SYSTEM_REPORT
          
      - name: Upload report
        uses: actions/upload-artifact@v4
        with:
          name: system-report
          path: ${{ env.SYSTEM_REPORT }}
